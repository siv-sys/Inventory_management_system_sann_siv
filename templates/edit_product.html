{% extends "base.html" %}
{% block title %}Edit Product - Inventory System{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
    <!-- Header with Gradient -->
    <div class="mb-8 text-center">
        <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-r from-green-500 to-emerald-600 rounded-2xl mb-4 shadow-lg">
            <i class="fas fa-edit text-white text-2xl"></i>
        </div>
        <h1 class="text-4xl font-bold bg-gradient-to-r from-green-600 to-emerald-600 bg-clip-text text-transparent mb-2">
            Edit Product
        </h1>
        <p class="text-gray-600 text-lg">Update and refine your product information</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Main Form -->
        <div class="lg:col-span-2">
            <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-100">
                <!-- Form Header -->
                <div class="bg-gradient-to-r from-green-600 to-emerald-600 px-8 py-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-2xl font-bold text-white">Update Product Details</h2>
                            <p class="text-green-100">Modify the information for {{ product.name }}</p>
                        </div>
                        <div class="w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
                            <i class="fas fa-sync-alt text-white text-xl"></i>
                        </div>
                    </div>
                </div>
                
                <form method="POST" class="p-8">
                    <div class="space-y-8">
                        <!-- Product Name -->
                        <div class="group">
                            <label for="name" class="block text-sm font-semibold text-gray-700 mb-3 flex items-center">
                                <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center mr-3 group-focus-within:bg-blue-500 transition-colors">
                                    <i class="fas fa-tag text-blue-500 group-focus-within:text-white transition-colors"></i>
                                </div>
                                Product Name *
                            </label>
                            <input type="text" id="name" name="name" value="{{ product.name }}" required
                                   class="w-full px-4 py-4 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all duration-300 placeholder-gray-400"
                                   placeholder="Enter product name...">
                        </div>

                        <!-- Category Section -->
                        <div class="group">
                            <label for="category" class="block text-sm font-semibold text-gray-700 mb-3 flex items-center">
                                <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center mr-3 group-focus-within:bg-purple-500 transition-colors">
                                    <i class="fas fa-folder text-purple-500 group-focus-within:text-white transition-colors"></i>
                                </div>
                                Category *
                            </label>
                            <div class="relative">
                                <input type="text" id="category" name="category" value="{{ product.category }}" required
                                       class="w-full px-4 py-4 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:ring-4 focus:ring-purple-100 transition-all duration-300 placeholder-gray-400"
                                       placeholder="Type or select a category"
                                       list="category-suggestions">
                                <datalist id="category-suggestions">
                                    {% for category in existing_categories %}
                                    <option value="{{ category }}">
                                    {% endfor %}
                                    <option value="Electronics">
                                    <option value="Clothing">
                                    <option value="Books">
                                    <option value="Home & Garden">
                                    <option value="Sports">
                                    <option value="Beauty">
                                    <option value="Food & Beverages">
                                    <option value="Health">
                                    <option value="Office Supplies">
                                    <option value="Pet Supplies">
                                    <option value="Automotive">
                                    <option value="Toys">
                                    <option value="Fashion">
                                    <option value="Jewelry">
                                    <option value="Furniture">
                                    <option value="Tools">
                                    <option value="Music">
                                    <option value="Art">
                                    <option value="Baby Products">
                                    <option value="Garden">
                                </datalist>
                            </div>
                        </div>

                        <!-- Price & Quantity Row -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Price -->
                            <div class="group">
                                <label for="price" class="block text-sm font-semibold text-gray-700 mb-3 flex items-center">
                                    <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center mr-3 group-focus-within:bg-green-500 transition-colors">
                                        <i class="fas fa-dollar-sign text-green-500 group-focus-within:text-white transition-colors"></i>
                                    </div>
                                    Price ($) *
                                </label>
                                <div class="relative">
                                    <span class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-500 font-medium">$</span>
                                    <input type="number" id="price" name="price" step="0.01" min="0" value="{{ product.price }}" required
                                           class="w-full pl-10 pr-4 py-4 border-2 border-gray-200 rounded-xl focus:border-green-500 focus:ring-4 focus:ring-green-100 transition-all duration-300">
                                </div>
                            </div>

                            <!-- Quantity -->
                            <div class="group">
                                <label for="quantity" class="block text-sm font-semibold text-gray-700 mb-3 flex items-center">
                                    <div class="w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center mr-3 group-focus-within:bg-orange-500 transition-colors">
                                        <i class="fas fa-cubes text-orange-500 group-focus-within:text-white transition-colors"></i>
                                    </div>
                                    Quantity *
                                </label>
                                <input type="number" id="quantity" name="quantity" min="0" value="{{ product.quantity }}" required
                                       class="w-full px-4 py-4 border-2 border-gray-200 rounded-xl focus:border-orange-500 focus:ring-4 focus:ring-orange-100 transition-all duration-300">
                            </div>
                        </div>

                        <!-- Description -->
                        <div class="group">
                            <label for="description" class="block text-sm font-semibold text-gray-700 mb-3 flex items-center">
                                <div class="w-8 h-8 bg-indigo-100 rounded-lg flex items-center justify-center mr-3 group-focus-within:bg-indigo-500 transition-colors">
                                    <i class="fas fa-align-left text-indigo-500 group-focus-within:text-white transition-colors"></i>
                                </div>
                                Description
                            </label>
                            <textarea id="description" name="description" rows="4"
                                      class="w-full px-4 py-4 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition-all duration-300 placeholder-gray-400 resize-none"
                                      placeholder="Describe your product...">{{ product.description or '' }}</textarea>
                        </div>
                    </div>

                    <!-- Quick Select Categories -->
                    <div class="mt-8 p-6 bg-gradient-to-r from-gray-50 to-green-50 rounded-2xl border border-gray-200">
                        <label class="block text-sm font-semibold text-gray-700 mb-4 flex items-center">
                            <div class="w-8 h-8 bg-yellow-100 rounded-lg flex items-center justify-center mr-3">
                                <i class="fas fa-bolt text-yellow-500"></i>
                            </div>
                            Quick Select Categories:
                        </label>
                        <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3">
                            {% set quick_categories = [
                                {'name': 'Electronics', 'icon': 'laptop', 'color': 'blue'},
                                {'name': 'Clothing', 'icon': 'tshirt', 'color': 'green'},
                                {'name': 'Books', 'icon': 'book', 'color': 'purple'},
                                {'name': 'Home & Garden', 'icon': 'home', 'color': 'orange'},
                                {'name': 'Sports', 'icon': 'basketball-ball', 'color': 'red'},
                                {'name': 'Beauty', 'icon': 'spa', 'color': 'pink'},
                                {'name': 'Food & Beverages', 'icon': 'utensils', 'color': 'yellow'},
                                {'name': 'Health', 'icon': 'heartbeat', 'color': 'indigo'}
                            ] %}
                            {% for cat in quick_categories %}
                            <button type="button" onclick="setCategory('{{ cat.name }}')" 
                                    class="p-3 bg-white rounded-xl border-2 border-{{ cat.color }}-100 hover:border-{{ cat.color }}-300 hover:shadow-md transition-all duration-300 group text-left">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 bg-{{ cat.color }}-100 rounded-lg flex items-center justify-center mr-2 group-hover:bg-{{ cat.color }}-500 transition-colors">
                                        <i class="fas fa-{{ cat.icon }} text-{{ cat.color }}-500 group-hover:text-white transition-colors text-sm"></i>
                                    </div>
                                    <span class="text-sm font-medium text-gray-700">{{ cat.name }}</span>
                                </div>
                            </button>
                            {% endfor %}
                        </div>
                    </div>
                   
                    <!-- Form Actions -->
                    <div class="mt-8 flex flex-col sm:flex-row justify-between items-center space-y-4 sm:space-y-0 pt-8 border-t border-gray-200">
                        <a href="{{ url_for('inventory') }}"
                           class="px-6 py-3 border-2 border-gray-300 rounded-xl text-gray-700 hover:bg-gray-50 hover:border-gray-400 transition-all duration-300 font-medium flex items-center group">
                            <i class="fas fa-arrow-left mr-2 group-hover:-translate-x-1 transition-transform"></i>
                            Back to Inventory
                        </a>

                        <div class="flex space-x-3">
                            <button type="reset"
                                    class="px-6 py-3 border-2 border-gray-300 rounded-xl text-gray-700 hover:bg-gray-50 hover:border-gray-400 transition-all duration-300 font-medium flex items-center group">
                                <i class="fas fa-undo mr-2 group-hover:rotate-180 transition-transform"></i>
                                Reset Changes
                            </button>

                            <button type="submit"
                                    class="px-8 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all duration-300 font-medium shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 flex items-center justify-center group">
                                <i class="fas fa-save mr-2 group-hover:scale-110 transition-transform"></i>
                                Update Product
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Sidebar - Product Preview & Info -->
        <div class="space-y-6">
            <!-- Product Preview Card -->
            <div class="bg-white rounded-2xl shadow-xl p-6 border border-gray-100">
                <h3 class="font-bold text-gray-900 mb-4 flex items-center">
                    <i class="fas fa-eye text-green-500 mr-2"></i>
                    Product Preview
                </h3>
                <div class="space-y-4">
                    <div class="flex items-center space-x-3">
                        <div class="w-12 h-12 bg-gradient-to-br from-blue-400 to-blue-600 rounded-xl flex items-center justify-center">
                            <i class="fas fa-box text-white"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-900">{{ product.name }}</h4>
                            <p class="text-sm text-gray-500">{{ product.category }}</p>
                        </div>
                    </div>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Current Price:</span>
                            <span class="font-bold text-green-600">${{ "%.2f"|format(product.price) }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Current Stock:</span>
                            <span class="font-bold {% if product.quantity == 0 %}text-red-600{% elif product.quantity < 10 %}text-yellow-600{% else %}text-green-600{% endif %}">
                                {{ product.quantity }} units
                            </span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Status:</span>
                            <span class="px-2 py-1 rounded-full text-xs font-medium {% if product.quantity == 0 %}bg-red-100 text-red-800{% elif product.quantity < 10 %}bg-yellow-100 text-yellow-800{% else %}bg-green-100 text-green-800{% endif %}">
                                {% if product.quantity == 0 %}Out of Stock{% elif product.quantity < 10 %}Low Stock{% else %}In Stock{% endif %}
                            </span>
                        </div>
                    </div>
                    <!-- Stock Level Bar -->
                    <div class="pt-2">
                        <div class="flex justify-between text-xs text-gray-600 mb-1">
                            <span>Stock Level</span>
                            <span>{{ product.quantity }} units</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            {% set percentage = (product.quantity / 100 * 100) if product.quantity <= 100 else 100 %}
                            <div class="h-2 rounded-full {% if product.quantity == 0 %}bg-red-500{% elif product.quantity < 10 %}bg-yellow-500{% else %}bg-green-500{% endif %}" 
                                 style="width: {{ percentage }}%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Editing Tips -->
            <div class="bg-gradient-to-br from-orange-50 to-amber-50 rounded-2xl shadow-xl p-6 border border-orange-200">
                <h3 class="font-bold text-gray-900 mb-4 flex items-center">
                    <i class="fas fa-lightbulb text-orange-500 mr-2"></i>
                    Editing Tips
                </h3>
                <div class="space-y-3">
                    <div class="flex items-start">
                        <i class="fas fa-check-circle text-green-500 mt-1 mr-3 flex-shrink-0"></i>
                        <p class="text-sm text-gray-700">Update stock levels regularly for accurate inventory</p>
                    </div>
                    <div class="flex items-start">
                        <i class="fas fa-check-circle text-green-500 mt-1 mr-3 flex-shrink-0"></i>
                        <p class="text-sm text-gray-700">Keep descriptions clear and informative</p>
                    </div>
                    <div class="flex items-start">
                        <i class="fas fa-check-circle text-green-500 mt-1 mr-3 flex-shrink-0"></i>
                        <p class="text-sm text-gray-700">Use consistent categories across products</p>
                    </div>
                    <div class="flex items-start">
                        <i class="fas fa-check-circle text-green-500 mt-1 mr-3 flex-shrink-0"></i>
                        <p class="text-sm text-gray-700">Set reorder alerts for low stock items</p>
                    </div>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl shadow-xl p-6 border border-blue-200">
                <h3 class="font-bold text-gray-900 mb-4 flex items-center">
                    <i class="fas fa-chart-bar text-blue-500 mr-2"></i>
                    Inventory Overview
                </h3>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">Total Products</span>
                        <span class="font-bold text-blue-600">{{ products|length }}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">Categories</span>
                        <span class="font-bold text-green-600">{{ existing_categories|length }}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">Low Stock Items</span>
                        <span class="font-bold text-yellow-600">{{ products|selectattr('quantity', 'lt', 10)|selectattr('quantity', 'gt', 0)|list|length }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Function to set category from quick select buttons
function setCategory(category) {
    const categoryInput = document.getElementById('category');
    categoryInput.value = category;
    categoryInput.focus();
    
    // Add visual feedback
    categoryInput.classList.add('ring-4', 'ring-purple-100');
    setTimeout(() => {
        categoryInput.classList.remove('ring-4', 'ring-purple-100');
    }, 1000);
}

// Auto-capitalize category first letter
document.getElementById('category').addEventListener('blur', function() {
    if (this.value.trim()) {
        this.value = this.value.trim().charAt(0).toUpperCase() + this.value.trim().slice(1);
    }
});

// Real-time form validation with visual feedback
const inputs = document.querySelectorAll('input[required], textarea');
inputs.forEach(input => {
    input.addEventListener('input', function() {
        if (this.value.trim()) {
            this.classList.add('border-green-400');
            this.classList.remove('border-red-400');
        } else {
            this.classList.remove('border-green-400');
        }
    });
    
    input.addEventListener('blur', function() {
        if (this.required && !this.value.trim()) {
            this.classList.add('border-red-400');
        }
    });
});

// Price formatting
document.getElementById('price').addEventListener('input', function(e) {
    let value = e.target.value.replace(/[^\d.]/g, '');
    let parts = value.split('.');
    if (parts.length > 2) {
        value = parts[0] + '.' + parts.slice(1).join('');
    }
    e.target.value = value;
});

// Character counter for description
document.getElementById('description').addEventListener('input', function(e) {
    const charCount = e.target.value.length;
    let counter = document.getElementById('char-counter');
    if (!counter) {
        counter = document.createElement('div');
        counter.id = 'char-counter';
        counter.className = 'text-xs text-gray-500 mt-2 text-right';
        e.target.parentNode.appendChild(counter);
    }
    counter.textContent = `${charCount} characters`;
});

// Enhanced form submission with loading state
document.querySelector('form').addEventListener('submit', function(e) {
    const submitBtn = this.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    
    // Add loading state
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Updating...';
    submitBtn.disabled = true;
    
    // Re-enable after 3 seconds (in case of error)
    setTimeout(() => {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    }, 3000);
});

// Reset form confirmation
document.querySelector('button[type="reset"]').addEventListener('click', function(e) {
    if (!confirm('Are you sure you want to reset all changes?')) {
        e.preventDefault();
    }
});

// Focus on name field when page loads
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('name').focus();
});
</script>

<style>
/* Custom animations */
@keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-5px); }
}

.floating {
    animation: float 3s ease-in-out infinite;
}

/* Enhanced focus states */
input:focus, textarea:focus, select:focus {
    transform: translateY(-2px);
    transition: all 0.3s ease;
}

/* Hover effects */
.hover-lift:hover {
    transform: translateY(-3px);
    transition: all 0.3s ease;
}

/* Success state for saved values */
input:valid, textarea:valid {
    border-color: #10B981;
}
</style>
{% endblock %}