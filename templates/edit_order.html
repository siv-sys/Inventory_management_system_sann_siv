{% extends "base.html" %}

{% block title %}Edit Order - Inventory System{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Header -->
    <div class="flex justify-between items-center">
        <div>
            <h1 class="text-3xl font-bold text-gray-900">Edit Order</h1>
            <p class="text-gray-600 mt-1">Update order #{{ order.order_id }} details</p>
        </div>
        <div class="flex space-x-4">
            <a href="{{ url_for('recent_orders') }}" 
               class="bg-gray-600 text-white px-6 py-3 rounded-lg hover:bg-gray-700 transition-colors flex items-center">
                <i class="fas fa-arrow-left mr-2"></i>
                Back to Orders
            </a>
        </div>
    </div>

    <!-- Order Form -->
    <div class="bg-white rounded-xl shadow">
        <form id="orderForm" method="POST" class="p-6">
            <!-- Customer Information -->
            <div class="mb-8">
                <h2 class="text-xl font-semibold text-gray-900 mb-4">Customer Information</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Customer Name <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="customerName" name="customerName" required
                               value="{{ order.customer_name }}"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Email Address <span class="text-red-500">*</span>
                        </label>
                        <input type="email" id="customerEmail" name="customerEmail" required
                               value="{{ order.customer_email }}"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                        <input type="tel" id="customerPhone" name="customerPhone"
                               value="{{ order.customer_phone or '' }}"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Customer Type</label>
                        <select id="customerType" name="customerType"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors">
                            <option value="Regular" {% if order.customer_type == 'Regular' %}selected{% endif %}>Regular Customer</option>
                            <option value="VIP" {% if order.customer_type == 'VIP' %}selected{% endif %}>VIP Customer</option>
                            <option value="Wholesale" {% if order.customer_type == 'Wholesale' %}selected{% endif %}>Wholesale</option>
                            <option value="First-time" {% if order.customer_type == 'First-time' %}selected{% endif %}>First-time Customer</option>
                        </select>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Shipping Address</label>
                        <textarea id="shippingAddress" name="shippingAddress" rows="3"
                                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                        >{{ order.shipping_address or '' }}</textarea>
                    </div>
                </div>
            </div>

            <!-- Order Details -->
            <div class="mb-8">
                <h2 class="text-xl font-semibold text-gray-900 mb-4">Order Details</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Order Date <span class="text-red-500">*</span>
                        </label>
                        <input type="date" id="orderDate" name="orderDate" required
                               value="{{ order.order_date.strftime('%Y-%m-%d') }}"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Status <span class="text-red-500">*</span>
                        </label>
                        <select id="orderStatus" name="orderStatus" required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors">
                            <option value="Pending" {% if order.status == 'Pending' %}selected{% endif %}>Pending</option>
                            <option value="Confirmed" {% if order.status == 'Confirmed' %}selected{% endif %}>Confirmed</option>
                            <option value="Processing" {% if order.status == 'Processing' %}selected{% endif %}>Processing</option>
                            <option value="Shipped" {% if order.status == 'Shipped' %}selected{% endif %}>Shipped</option>
                            <option value="Delivered" {% if order.status == 'Delivered' %}selected{% endif %}>Delivered</option>
                            <option value="Cancelled" {% if order.status == 'Cancelled' %}selected{% endif %}>Cancelled</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Payment Method</label>
                        <select id="paymentMethod" name="paymentMethod"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors">
                            <option value="Credit Card" {% if order.payment_method == 'Credit Card' %}selected{% endif %}>Credit Card</option>
                            <option value="PayPal" {% if order.payment_method == 'PayPal' %}selected{% endif %}>PayPal</option>
                            <option value="Bank Transfer" {% if order.payment_method == 'Bank Transfer' %}selected{% endif %}>Bank Transfer</option>
                            <option value="Cash" {% if order.payment_method == 'Cash' %}selected{% endif %}>Cash</option>
                            <option value="Other" {% if order.payment_method == 'Other' %}selected{% endif %}>Other</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Amount ($) <span class="text-red-500">*</span>
                        </label>
                        <input type="number" id="orderAmount" name="orderAmount" required step="0.01" min="0"
                               value="{{ order.amount }}"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tracking Number</label>
                        <input type="text" id="trackingNumber" name="trackingNumber"
                               value="{{ order.tracking_number or '' }}"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors">
                    </div>
                    <div class="md:col-span-3">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Order Notes</label>
                        <textarea id="orderNotes" name="orderNotes" rows="3"
                                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                        >{{ order.notes or '' }}</textarea>
                    </div>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="flex justify-end space-x-4 pt-6 border-t border-gray-200">
                <a href="{{ url_for('recent_orders') }}" 
                   class="px-6 py-3 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors">
                    Cancel
                </a>
                <button type="submit" 
                        class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center">
                    <i class="fas fa-save mr-2"></i>
                    Update Order
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Success Modal -->
<div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
        <div class="text-center">
            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-check text-green-600 text-2xl"></i>
            </div>
            <h3 class="text-xl font-bold text-gray-900 mb-2">Order Updated Successfully!</h3>
            <p class="text-gray-600 mb-6">Order {{ order.order_id }} has been updated successfully.</p>
            <div class="flex justify-center space-x-3">
                <a href="{{ url_for('edit_order', order_id=order.id) }}" 
                   class="px-6 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-md transition-colors">
                    Continue Editing
                </a>
                <a href="{{ url_for('recent_orders') }}" 
                   class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                    View Orders
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Show success modal if there's a success message
    document.addEventListener('DOMContentLoaded', function() {
        // Check if we should show success modal (you can set this via Flask flash messages)
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('success') === 'true') {
            document.getElementById('successModal').classList.remove('hidden');
        }
    });

    function closeSuccessModal() {
        document.getElementById('successModal').classList.add('hidden');
    }

    // Form submission handling
    document.getElementById('orderForm').addEventListener('submit', function(e) {
        // Form will be submitted normally since it's a POST form
        // You can add any client-side validation here if needed
    });
</script>
{% endblock %}